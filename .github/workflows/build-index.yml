name: Build Index Page

on:
  push:
      branches:
            - main

            permissions:
              contents: write

              jobs:
                build-index:
                    runs-on: ubuntu-latest
                        steps:
                              - name: Checkout repository
                                      uses: actions/checkout@v4

                                            - name: Generate index.html
                                                    run: |
                                                              cat > index.html << 'HTMLEOF'
                                                                        <!DOCTYPE html>
                                                                                  <html lang="en">
                                                                                            <head>
                                                                                                        <meta charset="UTF-8">
                                                                                                                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                                                                                                                <title>News – Singular Intelligence</title>
                                                                                                                                            <style>
                                                                                                                                                          body { font-family: Inter, sans-serif; background: #111; color: #f2f2f2; margin: 0; padding: 2rem; }
                                                                                                                                                                        h1 { color: #3ecfb2; margin-bottom: 1.5rem; }
                                                                                                                                                                                      ul { list-style: none; padding: 0; }
                                                                                                                                                                                                    li { margin: 0.75rem 0; }
                                                                                                                                                                                                                  a { color: #3ecfb2; text-decoration: none; font-size: 1.1rem; }
                                                                                                                                                                                                                                a:hover { text-decoration: underline; }
                                                                                                                                                                                                                                            </style>
                                                                                                                                                                                                                                                      </head>
                                                                                                                                                                                                                                                                <body>
                                                                                                                                                                                                                                                                            <h1>Singular Intelligence – Newsletter Archive</h1>
                                                                                                                                                                                                                                                                                        <ul>
                                                                                                                                                                                                                                                                                                  HTMLEOF
                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                            for f in $(ls *.html 2>/dev/null | grep -v '^index\.html$' | sort -r); do
                                                                                                                                                                                                                                                                                                                        label=$(echo "$f" | sed 's/\.html$//' | sed 's/-/ /g' | sed 's/_/ /g')
                                                                                                                                                                                                                                                                                                                                    echo "    <li><a href=\"$f\">$label</a></li>" >> index.html
                                                                                                                                                                                                                                                                                                                                              done
                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                        cat >> index.html << 'HTMLEOF'
                                                                                                                                                                                                                                                                                                                                                                    </ul>
                                                                                                                                                                                                                                                                                                                                                                              </body>
                                                                                                                                                                                                                                                                                                                                                                                        </html>
                                                                                                                                                                                                                                                                                                                                                                                                  HTMLEOF
                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                        - name: Commit index.html
                                                                                                                                                                                                                                                                                                                                                                                                                run: |
                                                                                                                                                                                                                                                                                                                                                                                                                          git config user.name "github-actions[bot]"
                                                                                                                                                                                                                                                                                                                                                                                                                                    git config user.email "github-actions[bot]@users.noreply.github.com"
                                                                                                                                                                                                                                                                                                                                                                                                                                              git add index.html
                                                                                                                                                                                                                                                                                                                                                                                                                                                        git diff --cached --quiet || git commit -m "Auto-update index.html"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  git push
