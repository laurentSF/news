name: Build Index Page

on:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  build-index:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Generate index.html
        run: |
          python3 -c "
          import os
          files = sorted([f for f in os.listdir('.') if f.endswith('.html') and f != 'index.html'], reverse=True)
          items = ''.join('<li><a href=\"' + f + '\">' + f.replace('.html','').replace('-',' ').replace('_',' ') + '</a></li>' for f in files)
          html = '<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><title>Singular Intelligence - Newsletter Archive</title><style>body{font-family:Inter,sans-serif;background:#111;color:#f2f2f2;margin:0;padding:2rem}h1{color:#3ecfb2}ul{list-style:none;padding:0}li{margin:.75rem 0}a{color:#3ecfb2;text-decoration:none;font-size:1.1rem}a:hover{text-decoration:underline}</style></head><body><h1>Singular Intelligence - Newsletter Archive</h1><ul>' + items + '</ul></body></html>'
          open('index.html','w').write(html)
          "

      - name: Commit index.html
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add index.html
          git diff --cached --quiet || git commit -m "Auto-update index.html"
          git push
